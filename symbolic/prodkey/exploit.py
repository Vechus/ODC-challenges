import angr
import claripy
from pwn import *


if args.FLAG:
    flagge = b'532836543989882060490007480756694257617764354509435740546591436540753920'
    r = connect('training.jinblack.it', 2021)
    r.sendline(flagge)
    r.interactive()
    

input_len = 30

prog = angr.Project('./prodkey', auto_load_libs=False)

find = [0x00400e58]
avoid = [0x00400e92]

input_flag = claripy.BVS('flag', input_len * 8)

state = prog.factory.entry_state(argv=['./prodkey'], stdin=input_flag)
simgr = prog.factory.simulation_manager(state)

simgr.explore(find=find, avoid=avoid)

if simgr.found:
    found = simgr.found[0]
    flag = found.solver.eval(input_flag)
    flag = bytearray.fromhex(str(hex(flag))[2:])

    print('flag:', flag)
    if args.SOLVE:
        r = connect('training.jinblack.it', 2021)
        r.sendline(flag)
        r.interactive()
    

